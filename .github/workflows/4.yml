 name: allure-junit5-maven

 on: [ push ]

 env:
   COUNT: Monday

 jobs:
   build:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v3

       - name: Set up JDK 19
         uses: actions/setup-java@v3
         with:
           java-version: '19'
           distribution: 'temurin'

       - name: Run Test
         if: always()
         run: mvn clean test
         continue-on-error: true
         
       - name: Get Allure history
         uses: actions/checkout@v3
         if: always()
         continue-on-error: true
         with:
           ref: gh-pages
           path: gh-pages

       - name: Allure Report action from marketplace
         uses: simple-elf/allure-report-action@master
         if: always()
         id: allure-report
         with:
           allure_results: allure-results
           gh_pages: gh-pages
           allure_report: allure-report
           allure_history: allure-history

       - name: Deploy report to Github Pages
         if: always()
         uses: peaceiris/actions-gh-pages@v2
         env:
           PERSONAL_TOKEN: ${{ secrets.GITHUB_TOKEN }}
           PUBLISH_BRANCH: gh-pages
           PUBLISH_DIR: allure-history
        
       - name: "report"
         id: report
         uses: mikepenz/action-junit-report@v3
         if: success() || failure()
         with:
           report_paths: '**/target/surefire-reports/TEST-*.xml'

       - name: Create a temporary artifact downloads folder
         run: mkdir downloads
           
       - name: Use the Upload Artifact GitHub Action
         uses: actions/upload-artifact@v3
         with: 
           name: allure-report-art
           path: downloads
           
       - name: Create a temporary artifact downloads folder
         run: 
           cd downloads
           ls
        
        
#        - name: dowlload
#          uses: actions/download-artifact@v3
#          with:
#            name: allure-report-art
        
#        - name: Create a temporary artifact downloads folder
#          run: ls
        
#        - name: Send email
#          uses: dawidd6/action-send-mail@v3
#          if: always()
#          with:
#            server_address: smtp.gmail.com
#            server_port: 465
#            username: ${{ secrets.EMAIL_USERNAME }}
#            password: ${{ secrets.EMAIL_PASSWORD }}
#            subject: ${{ github.job }} job of ${{ github.repository }} has ${{ job.status }}
#            html_body: \*\* ${{ github.job }} job in worflow \*\* ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }} <br> ALL TESTS COUNT IS "${{steps.report.outputs.total}}" FAILED TESTS IS "${{steps.report.outputs.failed}}" PASS TESTS IS "${{steps.report.outputs.passed}}"
#            to: ${{ secrets.EMAIL_USERNAME }}, ${{ secrets.EMAIL_USERNAME2 }}
#            attachments: allure-report
#            convert_markdown: true
#            from: John Doe
